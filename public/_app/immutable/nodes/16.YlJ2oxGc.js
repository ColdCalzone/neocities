var Q=Object.defineProperty;var $=(r,e,i)=>e in r?Q(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i;var x=(r,e,i)=>$(r,typeof e!="symbol"?e+"":e,i);import{s as V,n as R,o as j,A as ee,h as te,k as Z,B as se,r as ie}from"../chunks/scheduler.DqiQiJ2X.js";import{S as z,i as q,e as b,c as y,p as U,b as _,g as L,d as v,s as E,v as ne,h as K,a as P,l as M,w as ae,f as F,y as S,x as re,D as le,k as X,m as N,u as w,n as O,t as Y,j as G,o as H}from"../chunks/index.DJQJZrpW.js";import{g as oe}from"../chunks/globals.D0QH3NT1.js";function ce(r){let e,i="This page requires Javascript to render. Sorry.";return{c(){e=b("canvas"),e.textContent=i,this.h()},l(l){e=y(l,"CANVAS",{id:!0,class:!0,"data-svelte-h":!0}),U(e)!=="svelte-h7z6jf"&&(e.textContent=i),this.h()},h(){_(e,"id","cell-canvas"),_(e,"class","svelte-mthozf")},m(l,d){L(l,e,d)},p:R,i:R,o:R,d(l){l&&v(e)}}}function de(r,e,i){let{width:l=100}=e,{height:d=100}=e,{logic:u=(c,n,f,o,h)=>{let t={state:c.state};if(c.state>0)return t.state=c.state-1,t;for(let s of[-1,1])if(o(n+s,f).state==h)return t.state=h,t;for(let s of[-1,1])if(o(n,f+s).state==h)return t.state=h,t;return Math.trunc(Math.random()*1e4)==69&&(t.state=h),t}}=e,a;return j(()=>{class c{constructor(t,s,p=100,m=100){x(this,"palette");x(this,"cells");x(this,"canvas");x(this,"ctx");x(this,"width");x(this,"height");x(this,"cellLogic",()=>{});this.palette=[],this.setPalette(t),this.canvas=s,this.ctx=this.canvas.getContext("2d"),this.cells=Array.from({length:p*m},(C,k)=>{let T={state:Math.random()>.99?this.palette.length-1:0};return T.static&&(T.state=0),T}),this.height=m,this.width=p,this.canvas.width=this.width,this.canvas.height=this.height}setPalette(t){this.palette=[];for(let s of t){let p={r:parseInt(s.substring(1,3),16),g:parseInt(s.substring(3,5),16),b:parseInt(s.substring(5,7),16),a:255};this.palette.push(p)}}getCellWrapping(t,s){if(this.cells)return s%=this.height,t%=this.width,s<0&&(s=this.height+s),t<0&&(t=this.width+t),this.cells[this.width*s+t]}step(){this.cells=this.cells.map((t,s,p)=>{if(t.static)return t;let m=s%this.width,C=(s-m)/this.width;return this.cellLogic.bind(this)(t,m,C,this.getCellWrapping.bind(this),this.palette.length-1)||t})}setCellLogic(t){this.cellLogic=t}render(){let t=new Uint8ClampedArray(4*this.width*this.height);this.cells.map((s,p)=>this.palette.at(s.state%this.palette.length)).forEach((s,p)=>{t[p*4]=s.r,t[p*4+1]=s.g,t[p*4+2]=s.b,t[p*4+3]=s.a}),this.ctx.putImageData(new ImageData(t,this.width,this.height),0,0)}}const n=[["#030516","#2A4347","#218278","#18C0A9","#0FFFDB"],["#05252A","#431F32","#821A3A","#c01442","#FF0F4B"],["#4F1A4D","#432360","#372C73","#2B3686","#1F3F99","#1449AC"],["#000009","#4B00FF","#09DFFF","#4BFF09","#DFFB00","#FFB409","#FF0F4B"]];let f=parseInt(new URL(window.location.href).searchParams.get("palette"))%n.length||0,o=new c(n[f],document.getElementById("cell-canvas"),l,d);o.setCellLogic(u),document.getElementById("cell-canvas").onclick=()=>{f+=1,f%=n.length,o.setPalette(n[f])},a=setInterval(()=>{o.step(),o.render()},1e3/30)}),ee(()=>{a&&clearInterval(a)}),r.$$set=c=>{"width"in c&&i(0,l=c.width),"height"in c&&i(1,d=c.height),"logic"in c&&i(2,u=c.logic)},[l,d,u]}class he extends z{constructor(e){super(),q(this,e,de,ce,V,{width:0,height:1,logic:2})}}const{document:J}=oe;function ue(r){let e,i="",l,d,u,a,c,n,f;return{c(){e=b("script"),e.innerHTML=i,d=E(),u=b("div"),a=b("div"),c=ne(r[0]),this.h()},l(o){const h=K("svelte-7fphnf",J.head);e=y(h,"SCRIPT",{src:!0,integrity:!0,crossorigin:!0,referrerpolicy:!0,"data-svelte-h":!0}),U(e)!=="svelte-1but1ta"&&(e.innerHTML=i),h.forEach(v),d=P(o),u=y(o,"DIV",{id:!0,class:!0});var t=M(u);a=y(t,"DIV",{id:!0,class:!0});var s=M(a);c=ae(s,r[0]),s.forEach(v),t.forEach(v),this.h()},h(){te(e.src,l="https://cdnjs.cloudflare.com/ajax/libs/ace/1.33.0/ace.min.js")||_(e,"src",l),_(e,"integrity","sha512-RFjWk8prkK/avV0PuBatirOL57/Q/WSh6BZ82tohL95Ug5h+S9sZoVpRtk+L8LI6q0q5z5wCyrb9N2X+IuNcfA=="),_(e,"crossorigin","anonymous"),_(e,"referrerpolicy","no-referrer"),_(a,"id","editor"),_(a,"class","svelte-bz8xh7"),_(u,"id","editor-container"),_(u,"class","svelte-bz8xh7")},m(o,h){F(J.head,e),r[4](e),L(o,d,h),L(o,u,h),F(u,a),F(a,c),n||(f=S(e,"load",r[2]),n=!0)},p(o,[h]){h&1&&re(c,o[0])},i:R,o:R,d(o){o&&(v(d),v(u)),v(e),r[4](null),n=!1,f()}}}function fe(r,e,i){let{value:l=""}=e,{editor:d=void 0}=e,u;function a(){console.log("script loaded");var n=ace.edit("editor");n.setTheme("ace/theme/gruvbox"),n.session.setMode("ace/mode/javascript");let f=new URL(window.location.href).searchParams.get("script");f&&(h=>{const t=Uint8Array.from(atob(h),m=>m.charCodeAt(0)),s=new DecompressionStream("gzip"),p=s.writable.getWriter();return p.write(t),p.close(),new Response(s.readable).arrayBuffer().then(function(m){return new TextDecoder().decode(m)})})(f).then(h=>{n.setValue(h||l)}),i(3,d=n),document.getElementById("editor").style.display="block"}j(()=>{d||a()});function c(n){Z[n?"unshift":"push"](()=>{u=n,i(1,u)})}return r.$$set=n=>{"value"in n&&i(0,l=n.value),"editor"in n&&i(3,d=n.editor)},[l,u,a,d,c]}class ge extends z{constructor(e){super(),q(this,e,fe,ue,V,{value:0,editor:3})}}function pe(r){let e,i,l,d,u,a,c,n,f,o,h="Compile",t,s,p="Copy link",m,C,k;function T(g){r[4](g)}let B={value:`/*
  This JS code is run once per cell (100x100 = 10000 calls per frame. Be mindful.).
  variables:
    x: X position of the cell
    y: Y position of the cell
    cell: The original cell. It is advised you make a new cell as seen below.
    getCell(x, y): Gets a cell based on the coordinates.
    max_value: The highest state a cell can be in (based on the palette)

  Review the below code to get some ideas.
*/

let new_cell = {
  state: cell.state
};

if(cell.state > 0) {
  new_cell.state = cell.state - 1;
  return new_cell;
}

for(let offsetX of [-1, 1]) {
  if(getCell(x + offsetX, y).state == max_value) {
    new_cell.state = max_value;
    return new_cell;
  }
}

for(let offsetY of [-1, 1]) {
  if(getCell(x, y + offsetY).state == max_value) {
    new_cell.state = max_value; 
    return new_cell;
  }
}

if(Math.trunc(Math.random() * 10000) == 69) {
  new_cell.state = max_value;
}

return new_cell;`};return r[0]!==void 0&&(B.editor=r[0]),l=new ge({props:B}),Z.push(()=>le(l,"editor",T)),n=new he({props:{logic:r[1]}}),{c(){e=E(),i=b("div"),X(l.$$.fragment),u=E(),a=b("div"),c=b("div"),X(n.$$.fragment),f=E(),o=b("button"),o.textContent=h,t=E(),s=b("button"),s.textContent=p,this.h()},l(g){K("svelte-1djkzu0",document.head).forEach(v),e=P(g),i=y(g,"DIV",{class:!0,style:!0});var D=M(i);N(l.$$.fragment,D),D.forEach(v),u=P(g),a=y(g,"DIV",{class:!0,style:!0});var I=M(a);c=y(I,"DIV",{class:!0,style:!0});var W=M(c);N(n.$$.fragment,W),W.forEach(v),f=P(I),o=y(I,"BUTTON",{"data-svelte-h":!0}),U(o)!=="svelte-1dql93c"&&(o.textContent=h),t=P(I),s=y(I,"BUTTON",{"data-svelte-h":!0}),U(s)!=="svelte-32d48k"&&(s.textContent=p),I.forEach(v),this.h()},h(){document.title="CELLULAR_AUTOMATA",_(i,"class","terminal-container svelte-iv4t0v"),w(i,"flex","2"),w(i,"height","100%"),w(i,"padding","0"),w(i,"overflow","hidden"),_(c,"class","grid svelte-iv4t0v"),w(c,"width","100%"),_(a,"class","terminal-container svelte-iv4t0v"),w(a,"flex","1"),w(a,"height","100%"),w(a,"padding","18px"),w(a,"padding-top","30px")},m(g,A){L(g,e,A),L(g,i,A),O(l,i,null),L(g,u,A),L(g,a,A),F(a,c),O(n,c,null),F(a,f),F(a,o),F(a,t),F(a,s),m=!0,C||(k=[S(c,"mousemove",me),S(o,"click",r[2]),S(s,"click",r[3])],C=!0)},p(g,[A]){const D={};!d&&A&1&&(d=!0,D.editor=g[0],se(()=>d=!1)),l.$set(D)},i(g){m||(Y(l.$$.fragment,g),Y(n.$$.fragment,g),m=!0)},o(g){G(l.$$.fragment,g),G(n.$$.fragment,g),m=!1},d(g){g&&(v(e),v(i),v(u),v(a)),H(l),H(n),C=!1,ie(k)}}}function me(r){const{currentTarget:e}=r,i=e.getBoundingClientRect(),l=r.clientX-i.left,d=r.clientY-i.top;e.style.setProperty("--mouse-x",`${l}px`),e.style.setProperty("--mouse-y",`${d}px`)}function ve(r,e,i){let l=new Function,d,u=(f,o,h,t,s)=>l(f,o,h,t,s);function a(){d&&(l=new Function("cell","x","y","getCell","max_value",d.getValue()))}function c(){if(d){const f=h=>{const t=C=>new Promise((k,T)=>{const B=new FileReader;B.onloadend=()=>k(B.result.split(",")[1]),B.readAsDataURL(C)}),s=new TextEncoder().encode(h),p=new CompressionStream("gzip"),m=p.writable.getWriter();return m.write(s),m.close(),new Response(p.readable).blob().then(t)};let o=new URL(window.location.href);f(d.getValue()).then(h=>{o.searchParams.set("script",h),navigator.clipboard.writeText(o.href)})}}j(()=>{a()});function n(f){d=f,i(0,d)}return[d,u,a,c,n]}class Ce extends z{constructor(e){super(),q(this,e,ve,pe,V,{})}}export{Ce as component};
